<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Змейка</title>
</head>
<body>
  <canvas id="canvas" width="500" height="500"></canvas>
  <script src="https://code.jquery.com/jquery-2.1.0.js"></script>

<script>

//Создаем холст
canvas = document.getElementById("canvas")
ctx = canvas.getContext("2d")

//Получаем размеры поля
width = canvas.width
height = canvas.height

//Задаем начальный счет
blockSize = 10
widthInBlocks = width / blockSize
heightInBlocks = height / blockSize
score = 0
animationTime =  100

//Рисуем рамку
function drawBorder(){
  ctx.fillStyle = "Grey"
  ctx.fillRect(0,0,width,blockSize)
  ctx.fillRect(0,height-blockSize,width,blockSize)
  ctx.fillRect(0,0,blockSize,height)
  ctx.fillRect(width-blockSize,0,blockSize,height)
}

//Выводим счет
function drawScore(){
  ctx.font = "20px Courier"
  ctx.fillStyle = "Black"
  ctx.textBaseline = "top"
  ctx.textAlign = "left"
  ctx.fillText("Счет: " + score, blockSize, blockSize)
}

//Функция конца игры
function gameOver(){
//  clearInterval(intervalId)
  ctx.font = "60px Courier"
  ctx.fillStyle = "Black"
  ctx.textBaseline = "middle"
  ctx.textAlign = "center"
  ctx.fillText("Конец игры!", width / 2, height / 2 )
  animationTime = 100000
}

//Конструктор ячеек поля col-column-"столбец", row-строка
var Block = function (col,row) {
  this.col = col
  this.row = row
}

//Прототип отрисовки тела змеи
Block.prototype.drawSquare = function (colour) {
  x = this.col * blockSize
  y = this.row * blockSize
  ctx.fillStyle = colour
  ctx.fillRect(x,y,blockSize,blockSize)
}

//Прототип отрисовки яблока
Block.prototype.drawCircle = function (colour) {
  centerX = this.col * blockSize + blockSize / 2
  centerY = this.row * blockSize + blockSize / 2
  ctx.fillStyle = colour
  circle (centerX,centerY,blockSize)
}
function circle(x,y,blockSize,colour){
  ctx.beginPath()
  ctx.arc(x,y,blockSize/2,Math.PI*2,false)
  ctx.fillStyle = colour
  ctx.fill()
}

//Прототип проверки позиции ячеек (столкновение ячеек)
Block.prototype.equal = function (otherBlock){
  return this.col === otherBlock.col && this.row === otherBlock.row
}

//Конструктор Змейки
Snake = function(){
  this.segments = [
    new Block (7,5),
    new Block (6,5),
    new Block (5,5)
  ]
  this.direction = "right"
  this.nextDirection = "right"
}

//Рисуем змейку
Snake.prototype.draw = function () {

  for (i = 1; i < this.segments.length; i++) {
    this.segments[0].drawSquare("LightGreen")
if ( i % 2 === 0) {
    this.segments[i].drawSquare("Yellow")
  } else {
    this.segments[i].drawSquare("Blue")
  }
 }
}

//Перемещаем змейку collision - столкновение
Snake.prototype.move = function() {
  head = this.segments[0]

  this.direction = this.nextDirection

  if (this.direction === "right") {
    newHead = new Block(head.col + 1, head.row)
  } else if (this.direction === "down") {
    newHead = new Block(head.col, head.row + 1)
  } else if (this.direction === "left") {
    newHead = new Block(head.col - 1, head.row)
  } else if (this.direction === "up") {
    newHead = new Block(head.col, head.row - 1)
  }

  if (this.checkCollision(newHead)) {
    gameOver()
    return
  }

  this.segments.unshift(newHead)

  if (newHead.equal(apple.position)){
    score++
    apple.move()
    animationTime -= 10
  } else{
    this.segments.pop()
  }
}
//Проверка на столкновения
Snake.prototype.checkCollision = function(head) {
  leftCollision = (head.col === 0)
  topCollision = (head.row === 0)
  rightCollision = (head.col === widthInBlocks - 1)
  bottomCollision = (head.row === heightInBlocks - 1)

  wallCollision = leftCollision || topCollision || rightCollision || bottomCollision

  selfCollision = false

  for (i = 0; i < this.segments.length; i ++){
    if (head.equal(this.segments[i])){
      selfCollision = true
    }
  }
  return selfCollision || wallCollision
}
//Обработчик события с клавиатуры
directions = {
  37: "left",
  38: "up",
  39: "right",
  40: "down"
}

$("body").keydown(function (event) {
  newDirection = directions [event.keyCode]
  if (newDirection != undefined){
    snake.setDirection(newDirection)
  }
})
//Проверка допустимого направления
Snake.prototype.setDirection = function(newDirection){
  if (this.direction === "up" && newDirection === "down"){
    return
  }  else if (this.direction === "down" && newDirection === "up"){
    return
  } else if (this.direction === "left" && newDirection === "right"){
    return
  } else if (this.direction === "right" && newDirection === "left"){
    return
  }

  this.nextDirection = newDirection
}
//Конструктор яблока
Apple = function(){
  this.position = new Block(10,10)
}
Apple.prototype.draw = function (){
  this.position.drawCircle("LimeGreen")
}
Apple.prototype.move = function(){
  randomCol = Math.floor(Math.random() * (widthInBlocks - 2)) +1
  randomRow = Math.floor(Math.random()* (heightInBlocks - 2)) +1
  this.position = new Block (randomCol,randomRow)
}
snake = new Snake()
apple= new Apple()

gameLoop = function () {
  ctx.clearRect(0,0,width,height)
  drawScore()
  drawBorder()
  snake.draw()
  snake.move()
  apple.draw()
  setTimeout(gameLoop, animationTime)
}
gameLoop()
</script>

</body>
</html>
